# Clean Architecture vÃ  Domain-Driven Design (DDD)

**Clean Architecture** vÃ  **Domain-Driven Design (DDD)** lÃ  hai kiáº¿n trÃºc pháº§n má»m cÃ³ thá»ƒ káº¿t há»£p vá»›i nhau Ä‘á»ƒ táº¡o ra cÃ¡c há»‡ thá»‘ng dá»… báº£o trÃ¬, dá»… kiá»ƒm thá»­ vÃ  pháº£n Ã¡nh rÃµ rÃ ng nghiá»‡p vá»¥ cá»§a domain (lÄ©nh vá»±c kinh doanh).

---

## 1. Clean Architecture lÃ  gÃ¬?

Clean Architecture lÃ  má»™t kiáº¿n trÃºc pháº§n má»m do **Robert C. Martin (Uncle Bob)** Ä‘á» xuáº¥t, nháº¥n máº¡nh vÃ o:

- **TÃ¡ch biá»‡t rÃµ rÃ ng cÃ¡c táº§ng (layers)** trong á»©ng dá»¥ng.
- **HÆ°á»›ng domain**: logic nghiá»‡p vá»¥ náº±m á»Ÿ trung tÃ¢m, khÃ´ng bá»‹ phá»¥ thuá»™c vÃ o framework, UI hay database.
- **NguyÃªn táº¯c Dependency Rule**: Phá»¥ thuá»™c luÃ´n Ä‘i tá»« ngoÃ i vÃ o trong (tá»« UI, Infrastructure vÃ o Domain).

### CÃ¡c táº§ng trong Clean Architecture:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Outer Layer      â”‚ â† Frameworks & Drivers (Web, DB, UI)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚     Interface Layer    â”‚ â† Adapters (Controllers, Gateways)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Application/Use Case  â”‚ â† Use Cases (Business logic)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚      Domain Layer      â”‚ â† Entities (Core Business Rules)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. Domain-Driven Design (DDD) lÃ  gÃ¬?

DDD lÃ  má»™t cÃ¡ch tiáº¿p cáº­n thiáº¿t káº¿ pháº§n má»m do **Eric Evans** giá»›i thiá»‡u, táº­p trung vÃ o **domain (nghiá»‡p vá»¥)**. DDD khuyáº¿n khÃ­ch:

- **Táº­p trung vÃ o nghiá»‡p vá»¥** chá»© khÃ´ng pháº£i chi tiáº¿t ká»¹ thuáº­t.
- **NgÃ´n ngá»¯ chung (Ubiquitous Language)**: phÃ¡t triá»ƒn pháº§n má»m báº±ng cÃ¹ng má»™t ngÃ´n ngá»¯ mÃ  cáº£ dev vÃ  domain expert Ä‘á»u hiá»ƒu.
- **PhÃ¢n chia domain thÃ nh cÃ¡c Bounded Context** â€“ cÃ¡c vÃ¹ng Ä‘á»™c láº­p logic trong há»‡ thá»‘ng.
- **MÃ´ hÃ¬nh hoÃ¡ domain** thÃ´ng qua cÃ¡c khÃ¡i niá»‡m: Entity, Value Object, Aggregate, Repository, Service, v.v.

---

## 3. Clean Architecture káº¿t há»£p vá»›i DDD nhÆ° tháº¿ nÃ o?

Khi káº¿t há»£p:

| Clean Architecture     | DDD                              |
|------------------------|-----------------------------------|
| Domain Layer           | Entities, Value Objects           |
| Application Layer      | Use Cases, Domain Services        |
| Interface Layer        | Controllers, Presenters, Gateways |
| Infrastructure Layer   | Repositories, DB, External APIs   |

### VÃ­ dá»¥ mÃ´ hÃ¬nh trong Spring Boot:

```
src/
â”œâ”€â”€ domain/               â†’ DDD: Entities, ValueObjects
â”‚   â””â”€â”€ model/
â”‚   â””â”€â”€ service/
â”‚   â””â”€â”€ repository/
â”œâ”€â”€ application/          â†’ UseCases (Application Services)
â”‚   â””â”€â”€ usecase/
â”œâ”€â”€ interface/            â†’ Web Controllers, DTOs
â”‚   â””â”€â”€ web/
â”œâ”€â”€ infrastructure/       â†’ Implementation of Repository, DB, External Systems
â”‚   â””â”€â”€ persistence/
â”‚   â””â”€â”€ config/
```

---

## 4. Trong thá»i Ä‘áº¡i AI cÃ³ thá»ƒ viáº¿t code, há»c Clean ArchitectureClean Architecture vá»›i DDD Ä‘á»ƒ lÃ m gÃ¬?
Khi AI nhÆ° Copilot, ChatGPT, Cursor cÃ³ thá»ƒ tá»± Ä‘á»™ng sinh code CRUD, UI, APIs, báº¡n cÃ³ thá»ƒ nghÄ©:

â€œMÃ¬nh chá»‰ cáº§n biáº¿t code framework thÃ´i, AI lo pháº§n cÃ²n láº¡i.â€

âœ… NhÆ°ng AI hiá»‡n nay váº«n cáº§n ngÆ°á»i chá»‰ Ä‘áº¡o â€” vÃ  DDD chÃ­nh lÃ  má»™t lá»£i tháº¿ chiáº¿n lÆ°á»£c, bá»Ÿi:
| Lá»£i tháº¿                           | Giáº£i thÃ­ch                                                                                                           |
| --------------------------------- | -------------------------------------------------------------------------------------------------------------------- |
| ğŸ’¡ **Hiá»ƒu sÃ¢u nghiá»‡p vá»¥**         | DDD giÃºp báº¡n *tÆ° duy theo nghiá»‡p vá»¥*, Ä‘iá»u mÃ  AI chÆ°a thá»ƒ hiá»ƒu rÃµ ngá»¯ cáº£nh nhÆ° con ngÆ°á»i.                            |
| ğŸ§­ **Thiáº¿t káº¿ kiáº¿n trÃºc rÃµ rÃ ng** | DDD hÆ°á»›ng báº¡n Ä‘áº¿n há»‡ thá»‘ng dá»… báº£o trÃ¬, má»Ÿ rá»™ng, AI cÃ³ thá»ƒ viáº¿t code nhÆ°ng báº¡n thiáº¿t káº¿ bá»©c tranh tá»•ng thá»ƒ.           |
| ğŸ§  **Trá»Ÿ thÃ nh domain architect** | NgÆ°á»i náº¯m domain vÃ  Ä‘á»‹nh hÃ¬nh kiáº¿n trÃºc logic lÃ  ngÆ°á»i quyáº¿t Ä‘á»‹nh AI cáº§n lÃ m gÃ¬.                                     |
| ğŸ› ï¸ **HÆ°á»›ng dáº«n AI hiá»‡u quáº£**     | Khi báº¡n biáº¿t DDD, báº¡n cÃ³ thá»ƒ yÃªu cáº§u AI sinh code cho tá»«ng layer: Entity, Service, Aggregate... theo cÃ¡ch chuáº©n má»±c. |
| ğŸ” **Giáº£m technical debt**        | Kiáº¿n trÃºc rÃµ rÃ ng giáº£m bug, giáº£m chi phÃ­ báº£o trÃ¬ â€” Ä‘iá»u mÃ  AI-generated code chÆ°a Ä‘áº£m báº£o Ä‘Æ°á»£c.                      |

## 5. Example vá»›i Clean Architecture + DDD (báº±ng project nÃ y)

DÆ°á»›i Ä‘Ã¢y lÃ  vÃ­ dá»¥ thá»±c táº¿ vá» cÃ¡ch project nÃ y Ã¡p dá»¥ng Clean Architecture káº¿t há»£p DDD:

```
src/
â”œâ”€â”€ domain/               â†’ Chá»©a logic nghiá»‡p vá»¥ cá»‘t lÃµi (Entities, Model)
â”‚   â””â”€â”€ model/            â†’ Äá»‹nh nghÄ©a Entity (User, ...)
â”‚   â””â”€â”€ dao/              â†’ Giao diá»‡n truy xuáº¥t dá»¯ liá»‡u domain
â”œâ”€â”€ application/          â†’ Chá»©a cÃ¡c service nghiá»‡p vá»¥, tÃ¡ch biá»‡t vá»›i táº§ng domain
â”‚   â””â”€â”€ service/          â†’ Service nghiá»‡p vá»¥ (MessageService, ...)
â”‚   â””â”€â”€ service/command/  â†’ Xá»­ lÃ½ cÃ¡c command (ghi dá»¯ liá»‡u)
â”‚   â””â”€â”€ service/query/    â†’ Xá»­ lÃ½ cÃ¡c query (Ä‘á»c dá»¯ liá»‡u)
â”œâ”€â”€ interfaces/           â†’ Táº§ng giao tiáº¿p bÃªn ngoÃ i (REST API, DTO)
â”‚   â””â”€â”€ rest/             â†’ Controller REST (UserController, HelloWorldController)
â”œâ”€â”€ infrastructure/       â†’ Káº¿t ná»‘i vá»›i há»‡ thá»‘ng bÃªn ngoÃ i (DB, implement repository)
â”‚   â””â”€â”€ entity/           â†’ Entity Ã¡nh xáº¡ vá»›i DB (UserEntity, ...)
â”‚   â””â”€â”€ persistence/dao/  â†’ Triá»ƒn khai DAO
â”‚   â””â”€â”€ persistence/repository/ â†’ Triá»ƒn khai Repository (UserRepository)
```

### VÃ­ dá»¥ luá»“ng xá»­ lÃ½ táº¡o User:
1. **Controller** (interfaces/rest/UserController) nháº­n request táº¡o user.
2. Gá»i **Application Service** (application/service/command) Ä‘á»ƒ xá»­ lÃ½ logic táº¡o user.
3. Application Service thao tÃ¡c vá»›i **Domain Model** (domain/model/User) vÃ  sá»­ dá»¥ng **DAO/Repository** (domain/dao, infrastructure/persistence/repository) Ä‘á»ƒ lÆ°u xuá»‘ng DB.
4. **Infrastructure** thá»±c hiá»‡n lÆ°u trá»¯ thá»±c táº¿ qua JPA/Hibernate.

#### Lá»£i Ã­ch khi tá»• chá»©c theo Clean Architecture + DDD :

- **Táº­p trung vÃ o nghiá»‡p vá»¥ thay vÃ¬ chi tiáº¿t ká»¹ thuáº­t:**
  - ToÃ n bá»™ logic xá»­ lÃ½ nghiá»‡p vá»¥ (vÃ­ dá»¥: kiá»ƒm tra email Ä‘Ã£ tá»“n táº¡i, validate thÃ´ng tin User, quy táº¯c Ä‘áº·t tÃªn,...) Ä‘á»u náº±m á»Ÿ táº§ng domain/application. Äiá»u nÃ y giÃºp team chá»‰ cáº§n táº­p trung giáº£i quyáº¿t bÃ i toÃ¡n nghiá»‡p vá»¥, khÃ´ng bá»‹ phÃ¢n tÃ¢m bá»Ÿi chi tiáº¿t framework, database hay giao tiáº¿p API.
  - **VÃ­ dá»¥:** Khi táº¡o User, logic kiá»ƒm tra "email Ä‘Ã£ tá»“n táº¡i" sáº½ náº±m á»Ÿ domain service hoáº·c application service, khÃ´ng náº±m trong controller hay repository.

- **Dá»… báº£o trÃ¬ do cÃ¡c lá»›p Ä‘Æ°á»£c tÃ¡ch biá»‡t rÃµ rÃ ng:**
  - Khi cáº§n thay Ä‘á»•i quy táº¯c nghiá»‡p vá»¥ (vÃ­ dá»¥: bá»• sung Ä‘iá»u kiá»‡n User pháº£i trÃªn 18 tuá»•i), chá»‰ cáº§n sá»­a á»Ÿ domain/application, khÃ´ng áº£nh hÆ°á»Ÿng Ä‘áº¿n táº§ng giao tiáº¿p (REST, DB, UI). Má»—i lá»›p cÃ³ trÃ¡ch nhiá»‡m riÃªng biá»‡t, code dá»… Ä‘á»c, dá»… debug.
  - **VÃ­ dá»¥:** Náº¿u thay Ä‘á»•i cÃ¡ch sinh mÃ£ User, chá»‰ cáº§n sá»­a á»Ÿ domain/model/User hoáº·c application/service/command, khÃ´ng pháº£i sá»­a controller hay repository.

- **Dá»… kiá»ƒm thá»­ domain vÃ  use case khÃ´ng phá»¥ thuá»™c framework:**
  - CÃ³ thá»ƒ viáº¿t unit test cho domain/service mÃ  khÃ´ng cáº§n khá»Ÿi Ä‘á»™ng Spring hay káº¿t ná»‘i DB, nhá» Ä‘Ã³ kiá»ƒm thá»­ nhanh vÃ  hiá»‡u quáº£.
  - **VÃ­ dá»¥:** CÃ³ thá»ƒ mock UserDao Ä‘á»ƒ test logic táº¡o User mÃ  khÃ´ng cáº§n truy cáº­p database thá»±c táº¿.

- **Há»‡ thá»‘ng linh hoáº¡t, dá»… má»Ÿ rá»™ng hoáº·c thay tháº¿ cÃ´ng nghá»‡ (DB, UI):**
  - Náº¿u muá»‘n Ä‘á»•i DB (MySQL â†’ MongoDB) hoáº·c thÃªm API (REST â†’ GraphQL), chá»‰ cáº§n thay Ä‘á»•i á»Ÿ táº§ng infrastructure mÃ  khÃ´ng áº£nh hÆ°á»Ÿng Ä‘áº¿n domain logic.
  - **VÃ­ dá»¥:** Náº¿u chuyá»ƒn tá»« JPA sang MongoDB, chá»‰ cáº§n viáº¿t láº¡i pháº§n implement UserDao á»Ÿ infrastructure/persistence/dao mÃ  khÃ´ng pháº£i sá»­a logic táº¡o User á»Ÿ application/service/command.

**TÃ³m láº¡i:**  
Khi tá»• chá»©c theo Clean Architecture + DDD, má»—i thay Ä‘á»•i vá» nghiá»‡p vá»¥ chá»‰ tÃ¡c Ä‘á»™ng Ä‘áº¿n domain/application, cÃ²n thay Ä‘á»•i vá» cÃ´ng nghá»‡ chá»‰ tÃ¡c Ä‘á»™ng Ä‘áº¿n infrastructure. Äiá»u nÃ y giÃºp há»‡ thá»‘ng vá»«a bá»n vá»¯ng vá» máº·t nghiá»‡p vá»¥, vá»«a linh hoáº¡t vá» máº·t ká»¹ thuáº­t.
